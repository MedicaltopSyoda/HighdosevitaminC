<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tinder風がん情報アプリ</title>
<style>
  body {
    margin: 0;
    font-family: "Arial", sans-serif;
    background: #f8f8f8;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  .view {
    display: none;
    position: absolute;
    width: 100vw;
    height: 100vh;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    text-align: center;
    transition: opacity 0.5s;
  }
  .view.active { display: flex; }
  .fade-out { opacity: 0; }

  /* Tinderカード */
  .card {
    position: absolute;
    width: 80vw; max-width: 360px; height: 62vh;
    background: #fff; border-radius: 16px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.18);
    display: flex; flex-direction: column; justify-content: space-between;
    padding: 20px; user-select: none;
    transition: transform 0.3s ease, opacity 0.3s ease;
  }
  .card-question {
    flex: 1; display: flex; justify-content: center; align-items: center;
    font-size: 22px; font-weight: bold; text-align: center;
  }
  .card-options {
    display: flex; justify-content: space-between; font-size: 18px; margin-top: 20px;
  }
  .left-option { color: #e91e63; }
  .right-option { color: #2196f3; }

  /* スワイプ色エフェクト */
  .card::before {
    content: ""; position: absolute; inset: 0; border-radius: 16px;
    background: transparent; pointer-events: none; transition: background 0.15s;
  }
  .card.swipe-left::before { background: rgba(233,30,99,0.12); }
  .card.swipe-right::before { background: rgba(33,150,243,0.12); }

  /* 最終ビュー（共通コンテナ） */
  .final-wrap {
    background:#fff; padding:16px; width:92vw; max-width:520px; max-height:86vh;
    border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.2);
    overflow:auto; text-align:left;
  }
  .final-wrap h2 { margin: 0 0 12px; font-size: 20px; }
  ul { padding-left:20px; }

  /* 患者リスト（カード風グリッド） */
  .cards-grid {
    display:grid; grid-template-columns: repeat(2, 1fr); gap:12px; margin-top:8px;
  }
  .p-card {
    background:#fff; border:1px solid #eee; border-radius:12px; padding:12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    display:flex; flex-direction:column; gap:6px;
  }
  .p-card h3 {
    margin:0; font-size:16px; line-height:1.3;
  }
  .p-meta { font-size:12px; color:#555; line-height:1.4; }
  .p-tag {
    display:inline-block; font-size:11px; background:#f3f6fc; border:1px solid #e2e8f5;
    padding:2px 6px; border-radius:999px; margin-right:6px;
  }
  .p-card button {
    margin-top:6px; width:100%; padding:8px; font-size:14px;
    border:none; border-radius:8px; background:#2196f3; color:#fff;
  }

  /* 患者詳細 */
  .detail-head { display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
  .back-link { font-size:14px; color:#2196f3; text-decoration:underline; background:none; border:none; }
  .detail-box { background:#fafafa; border:1px solid #eee; border-radius:8px; padding:10px; margin:10px 0; }
  .cta {
    width:100%; padding:12px; font-size:16px; background:#e91e63; color:#fff;
    border:none; border-radius:8px;
  }

  /* 問い合わせフォーム */
  form { display:flex; flex-direction:column; gap:10px; margin-top:12px; }
  input, textarea {
    width:100%; box-sizing:border-box; padding:10px; font-size:16px; border:1px solid #ddd; border-radius:8px;
  }
  .submit { background:#2196f3; color:#fff; border:none; border-radius:8px; padding:12px; font-size:16px; }
</style>
</head>
<body>

<!-- 1stビュー -->
<div class="view active" id="view1" style="background:#fff; color:#e91e63; font-size:24px;">
  がんの情報のすべてがここにある
</div>

<!-- Tinderカードコンテナ -->
<div class="view" id="card-container"></div>

<!-- 最終ビュー（各種リスト・患者一覧・詳細・フォームをここに描画） -->
<div class="view" id="final-view">
  <div class="final-wrap" id="final-content"></div>
</div>

<script>
/* ========= 分岐定義 ========= */
const flow = {
  start: { q:"あなたはがん患者ですか？", left:"いいえ", right:"はい",
    next:{ left:"notpatient", right:"patient" } },
  patient: { q:"どちらを知りたいですか？", left:"同じ患者", right:"エビデンス",
    next:{ left:"patientlist", right:"evidence" } },
  notpatient: { q:"あなたは？", left:"それ以外", right:"家族",
    next:{ left:"other", right:"family" } },
  family: { q:"何を知りたいですか？", left:"生存率", right:"治療法",
    next:{ left:"survival", right:"treatment" } },
  other: { q:"あなたは？", left:"それ以外", right:"研究者",
    next:{ left:"contact", right:"contact" } }
};

/* ========= ダミーデータ ========= */
const patients = [
  { id:1, sex:"男性", age:55, cancer:"肺がん", stage:"Stage IIIA", years:2.0,
    summary:"手術＋化学放射線療法後、分子標的薬を継続中。副作用マネジメントに関心。",
    city:"東京", contact:"patient1@example.com" },
  { id:2, sex:"女性", age:42, cancer:"乳がん", stage:"Stage IIB", years:1.5,
    summary:"術前化学療法→乳房温存手術→放射線。仕事と治療の両立を情報交換したい。",
    city:"横浜", contact:"patient2@example.com" },
  { id:3, sex:"男性", age:68, cancer:"前立腺がん", stage:"Stage IV", years:3.0,
    summary:"ホルモン療法と放射線を併用。運動・栄養の工夫も共有可能。",
    city:"名古屋", contact:"patient3@example.com" },
  { id:4, sex:"女性", age:50, cancer:"大腸がん", stage:"Stage III", years:2.5,
    summary:"腹腔鏡手術後の補助化学療法。再発不安との向き合い方に関心。",
    city:"大阪", contact:"patient4@example.com" }
];

/* ========= 最終結果（固定HTML） ========= */
const staticResults = {
  evidence: "<h2>エビデンスリスト</h2><ul><li>治療法Aのランダム化比較試験（要約）</li><li>治療法Bのシステマティックレビュー（要約）</li></ul>",
  treatment: "<h2>治療法リスト</h2><ul><li>手術療法</li><li>化学療法</li><li>放射線療法</li><li>免疫療法</li><li>分子標的療法</li></ul>",
  survival: "<h2>がん種ごとの生存率</h2><ul><li>肺がん：5年生存率 30%（例）</li><li>乳がん：5年生存率 90%（例）</li><li>大腸がん：5年生存率 70%（例）</li></ul>",
  contact: `<h2>お問い合わせ</h2>
    <p>ご用件をお知らせください。担当よりご連絡いたします。</p>
    <form onsubmit="event.preventDefault(); alert('送信しました。担当からご連絡します。');">
      <input type="text" placeholder="お名前" required>
      <input type="email" placeholder="メールアドレス" required>
      <textarea rows="4" placeholder="お問い合わせ内容" required></textarea>
      <button class="submit" type="submit">送信</button>
    </form>`
};

/* ========= 画面制御 ========= */
let currentNode = "start";
const container = document.getElementById("card-container");
const finalView = document.getElementById("final-view");
const finalContent = document.getElementById("final-content");

/* Tinderカード作成 */
function createCard(nodeKey) {
  const data = flow[nodeKey];
  const card = document.createElement('div');
  card.className = 'card';
  card.innerHTML = `
    <div class="card-question">${data.q}</div>
    <div class="card-options">
      <div class="left-option">← ${data.left}</div>
      <div class="right-option">${data.right} →</div>
    </div>
  `;
  container.appendChild(card);

  let startX = 0, dx = 0, dragging = false;

  card.addEventListener('touchstart', e => {
    startX = e.touches[0].clientX; dragging = true;
  });
  card.addEventListener('touchmove', e => {
    if(!dragging) return;
    dx = e.touches[0].clientX - startX;
    card.style.transform = `translateX(${dx}px) rotate(${dx*0.05}deg)`;
    card.classList.toggle('swipe-right', dx > 30);
    card.classList.toggle('swipe-left', dx < -30);
  });
  card.addEventListener('touchend', () => {
    dragging = false;
    card.classList.remove('swipe-left','swipe-right');
    if(Math.abs(dx) > 100){
      const dir = dx > 0 ? 'right' : 'left';
      const nextNode = data.next[dir];
      card.style.transform = `translateX(${dx>0?520:-520}px) rotate(${dx*0.1}deg)`;
      card.style.opacity = 0;
      setTimeout(()=>{ container.removeChild(card); handleNext(nextNode); }, 260);
    } else {
      card.style.transform = `translateX(0) rotate(0deg)`;
    }
    dx = 0;
  });
}

/* 分岐先の処理 */
function handleNext(nodeKey){
  if(nodeKey === "patientlist"){
    showPatientsList();
    return;
  }
  if(staticResults[nodeKey]){
    showFinal(staticResults[nodeKey]);
    return;
  }
  // さらに質問カードがある場合
  createCard(nodeKey);
}

/* 共通：最終ビュー表示 */
function showFinal(html){
  container.classList.remove("active");
  finalView.classList.add("active");
  finalContent.innerHTML = html;
}

/* ======= 患者リスト（カード表示） ======= */
function showPatientsList(){
  container.classList.remove("active");
  finalView.classList.add("active");

  const listHTML = `
    <h2>患者リスト</h2>
    <div class="cards-grid">
      ${patients.map(p => `
        <div class="p-card" onclick="showPatientDetail(${p.id})" role="button" tabindex="0">
          <h3>${p.sex}・${p.age}歳</h3>
          <div class="p-meta">${p.cancer}／${p.stage}</div>
          <div class="p-meta">治療年数：${p.years}年</div>
          <div>
            <span class="p-tag">${p.city}</span>
            <span class="p-tag">${p.cancer}</span>
          </div>
          <button type="button">詳細を見る</button>
        </div>
      `).join('')}
    </div>
  `;
  finalContent.innerHTML = listHTML;
}

/* ======= 患者詳細（タップで遷移） ======= */
window.showPatientDetail = function(id){
  const p = patients.find(x => x.id === id);
  if(!p) return;
  finalContent.innerHTML = `
    <div class="detail-head">
      <h2>患者詳細</h2>
      <button class="back-link" onclick="showPatientsList()">← 一覧へ戻る</button>
    </div>
    <div class="detail-box">
      <div><strong>性別・年齢：</strong>${p.sex}・${p.age}歳</div>
      <div><strong>がん種・ステージ：</strong>${p.cancer}／${p.stage}</div>
      <div><strong>治療年数：</strong>${p.years}年</div>
      <div><strong>地域：</strong>${p.city}</div>
    </div>
    <p>${p.summary}</p>
    <button class="cta" onclick="openContact('${p.contact}')">連絡する</button>
  `;
}

/* 連絡ボタン：簡易フォーム or メール起動 */
window.openContact = function(email){
  // ここを mailto にするとメールアプリ起動： location.href = 'mailto:' + email;
  // 今回はアプリ内フォームを開く
  finalContent.innerHTML += `
    <div class="detail-box">
      <h3 style="margin:0 0 8px;">連絡フォーム</h3>
      <form onsubmit="event.preventDefault(); alert('メッセージを送信しました'); showPatientsList();">
        <input type="text" placeholder="お名前" required>
        <input type="email" placeholder="メールアドレス" required>
        <textarea rows="4" placeholder="メッセージ（${email} 宛）" required></textarea>
        <button class="submit" type="submit">送信</button>
      </form>
    </div>
  `;
}

/* 初期：1秒後に1stビューをフェードアウトしてカード開始 */
setTimeout(() => {
  document.getElementById("view1").classList.add("fade-out");
  setTimeout(() => {
    document.getElementById("view1").style.display = "none";
    container.classList.add("active");
    createCard(currentNode);
  }, 500);
}, 1000);
</script>

</body>
</html>