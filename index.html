<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tinder風がん情報アプリ</title>
<style>
  body {
    margin: 0;
    font-family: "Arial", sans-serif;
    background: #f8f8f8;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  .view {
    display: none;
    position: absolute;
    width: 100vw;
    height: 100vh;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    text-align: center;
    transition: opacity 0.5s;
  }
  .view.active {
    display: flex;
  }
  .fade-out { opacity: 0; }

  /* カード */
  .card {
    position: absolute;
    width: 80vw;
    max-width: 350px;
    height: 60vh;
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 20px;
    user-select: none;
    transition: transform 0.3s ease, opacity 0.3s ease;
  }
  .card-question {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 22px;
    font-weight: bold;
    text-align: center;
  }
  .card-options {
    display: flex;
    justify-content: space-between;
    font-size: 18px;
    margin-top: 20px;
  }
  .left-option { color: #e91e63; }
  .right-option { color: #2196f3; }

  /* スワイプ中エフェクト */
  .card::before {
    content: "";
    position: absolute;
    top:0; left:0;
    width:100%; height:100%;
    border-radius:15px;
    background: transparent;
    pointer-events: none;
    transition: background 0.2s;
  }
  .card.swipe-left::before { background: rgba(233,30,99,0.1); }
  .card.swipe-right::before { background: rgba(33,150,243,0.1); }

  /* 最終ビュー */
  .final-view {
    background:#fff;
    padding:20px;
    width:80vw;
    max-width:400px;
    border-radius:10px;
    box-shadow:0 4px 15px rgba(0,0,0,0.2);
    text-align:left;
  }
  ul { padding-left:20px; }
  form { display:flex; flex-direction:column; gap:10px; margin-top:15px; }
  input,textarea {
    padding:8px;
    font-size:16px;
    width:100%;
    box-sizing:border-box;
  }
  button {
    padding:10px;
    background:#2196f3;
    color:white;
    border:none;
    border-radius:5px;
    font-size:16px;
  }
</style>
</head>
<body>

<!-- 1stビュー -->
<div class="view active" id="view1" style="background:#fff; color:#e91e63; font-size:24px;">
  がんの情報のすべてがここにある
</div>

<!-- カードコンテナ -->
<div class="view" id="card-container"></div>

<!-- 最終ビュー -->
<div class="view" id="final-view">
  <div class="final-view" id="final-content"></div>
</div>

<script>
// 分岐定義
const flow = {
  start: { q:"あなたはがん患者ですか？", left:"いいえ", right:"はい",
    next:{left:"notpatient", right:"patient"} },
  patient: { q:"どちらを知りたいですか？", left:"同じ患者", right:"エビデンス",
    next:{left:"patientlist", right:"evidence"} },
  notpatient: { q:"あなたは？", left:"それ以外", right:"家族",
    next:{left:"other", right:"family"} },
  family: { q:"何を知りたいですか？", left:"生存率", right:"治療法",
    next:{left:"survival", right:"treatment"} },
  other: { q:"あなたは？", left:"それ以外", right:"研究者",
    next:{left:"contact", right:"contact"} }
};

// 最終結果HTML
const results = {
  evidence: "<h2>エビデンスリスト</h2><ul><li>治療法Aの論文</li><li>治療法Bの統計</li></ul>",
  patientlist: "<h2>患者リスト</h2><ul><li>50代男性・肺がん</li><li>40代女性・乳がん</li></ul>",
  treatment: "<h2>治療法リスト</h2><ul><li>手術療法</li><li>抗がん剤療法</li><li>免疫療法</li></ul>",
  survival: "<h2>がん種ごとの生存率</h2><ul><li>肺がん：5年生存率 30%</li><li>乳がん：5年生存率 90%</li></ul>",
  contact: `<h2>お問い合わせフォーム</h2>
    <form>
      <input type="text" placeholder="お名前">
      <input type="email" placeholder="メールアドレス">
      <textarea placeholder="お問い合わせ内容"></textarea>
      <button type="submit">送信</button>
    </form>`
};

let currentNode = "start";
let container = document.getElementById("card-container");

function createCard(nodeKey) {
  const data = flow[nodeKey];
  const card = document.createElement('div');
  card.className = 'card';
  card.innerHTML = `
    <div class="card-question">${data.q}</div>
    <div class="card-options">
      <div class="left-option">← ${data.left}</div>
      <div class="right-option">${data.right} →</div>
    </div>
  `;
  container.appendChild(card);

  let startX = 0, currentX = 0, dragging = false;

  card.addEventListener('touchstart', e => {
    startX = e.touches[0].clientX;
    dragging = true;
  });

  card.addEventListener('touchmove', e => {
    if(!dragging) return;
    currentX = e.touches[0].clientX - startX;
    card.style.transform = `translateX(${currentX}px) rotate(${currentX*0.05}deg)`;

    card.classList.remove('swipe-left','swipe-right');
    if(currentX>30) card.classList.add('swipe-right');
    else if(currentX<-30) card.classList.add('swipe-left');
  });

  card.addEventListener('touchend', e => {
    dragging = false;
    card.classList.remove('swipe-left','swipe-right');
    if(Math.abs(currentX) > 100){
      let direction = currentX > 0 ? 'right' : 'left';
      let nextNode = data.next[direction];

      card.style.transform = `translateX(${currentX>0?500:-500}px) rotate(${currentX*0.1}deg)`;
      card.style.opacity = 0;
      setTimeout(()=> {
        container.removeChild(card);
        handleNext(nextNode);
      }, 300);
    } else {
      card.style.transform = `translateX(0) rotate(0deg)`;
    }
    currentX = 0;
  });
}

function handleNext(nodeKey){
  if(results[nodeKey]){
    showFinal(results[nodeKey]);
  } else {
    createCard(nodeKey);
  }
}

function showFinal(html){
  document.getElementById("card-container").classList.remove("active");
  document.getElementById("final-view").classList.add("active");
  document.getElementById("final-content").innerHTML = html;
}

// 初期表示
setTimeout(() => {
  document.getElementById("view1").classList.add("fade-out");
  setTimeout(() => {
    document.getElementById("view1").style.display = "none";
    document.getElementById("card-container").classList.add("active");
    createCard(currentNode);
  }, 1000);
}, 1500);
</script>

</body>
</html>